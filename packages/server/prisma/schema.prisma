generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  email        String   @unique
  username     String   @unique
  passwordHash String   @map("password_hash")
  status       UserStatus @default(PENDING)
  role         UserRole   @default(USER)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  ownedGroups  Group[]       @relation("GroupOwner")
  groupMembers GroupMember[]
  createdTodos Todo[]

  @@map("users")
}

enum UserStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum UserRole {
  ADMIN
  USER
}

model Group {
  id          String   @id @default(uuid())
  name        String
  description String?
  ownerId     String   @map("owner_id")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  owner   User          @relation("GroupOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  members GroupMember[]
  todos   Todo[]

  @@map("groups")
}

model GroupMember {
  id       String     @id @default(uuid())
  groupId  String     @map("group_id")
  userId   String     @map("user_id")
  role     MemberRole @default(MEMBER)
  joinedAt DateTime   @default(now()) @map("joined_at")

  group Group @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@map("group_members")
}

enum MemberRole {
  OWNER
  MEMBER
}

model Todo {
  id                  String      @id @default(uuid())
  groupId             String      @map("group_id")
  title               String
  description         String?
  priority            TodoPriority @default(NORMAL)
  status              TodoStatus   @default(PENDING)
  scheduledAt         DateTime    @map("scheduled_at")
  completedAt         DateTime?   @map("completed_at")
  notificationEnabled Boolean     @default(true) @map("notification_enabled")
  createdBy           String      @map("created_by")
  createdAt           DateTime    @default(now()) @map("created_at")
  updatedAt           DateTime    @updatedAt @map("updated_at")

  group   Group @relation(fields: [groupId], references: [id], onDelete: Cascade)
  creator User  @relation(fields: [createdBy], references: [id])

  @@index([scheduledAt])
  @@index([groupId])
  @@map("todos")
}

enum TodoPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum TodoStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

